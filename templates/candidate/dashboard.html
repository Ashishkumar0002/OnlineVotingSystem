<!-- Candidate Dashboard Page -->
<!-- This page displays candidate-specific information and voting statistics -->
{% extends 'base.html' %}

<!-- Page content block - inherited from base.html -->
{% block content %}
<div class="container-fluid">
    <div class="row">
        <!-- Sidebar Navigation -->
        <!-- Candidate sidebar with navigation options -->
        <div class="col-md-3">
            <div class="card shadow-sm mb-4" style="position: sticky; top: 20px;">
                <!-- Sidebar header with candidate info -->
                <div class="card-body text-center">
                    <!-- Display candidate icon -->
                    <div style="font-size: 48px; margin-bottom: 15px; color: #4e73df;">
                        <i class="fas fa-user-tie"></i>
                    </div>
                    <!-- Display candidate name -->
                    <h5 class="card-title">{{ logged_in_user.name }}</h5>
                    <!-- Display candidate role badge -->
                    <p class="text-muted mb-2">
                        <span class="badge badge-info">Candidate</span>
                    </p>
                    <!-- Display party affiliation -->
                    {% if logged_in_user.candidates %}
                    <p class="small">
                        <i class="fas fa-flag"></i> 
                        <strong>{{ logged_in_user.candidates[0].party_name }}</strong>
                    </p>
                    {% endif %}
                </div>

                <!-- Candidate navigation menu -->
                <div class="list-group list-group-flush">
                    <!-- Link to dashboard (current page) -->
                    <a href="{{ url_for('candidate.dashboard') }}" class="list-group-item list-group-item-action active">
                        <i class="fas fa-chart-line"></i> Dashboard
                    </a>
                    <!-- Link to submit nomination -->
                    <a href="{{ url_for('candidate.submit_nomination') }}" class="list-group-item list-group-item-action">
                        <i class="fas fa-file-contract"></i> Submit Nomination
                    </a>
                    <!-- Link to view results -->
                    <a href="{{ url_for('candidate.results') }}" class="list-group-item list-group-item-action">
                        <i class="fas fa-chart-bar"></i> View Results
                    </a>
                    <!-- Logout link -->
                    <a href="{{ url_for('auth.logout') }}" class="list-group-item list-group-item-action text-danger">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </a>
                </div>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="col-md-9">
            <!-- Page header with title -->
            <h2 class="mb-4">
                <i class="fas fa-chart-line text-primary"></i> Candidate Dashboard
            </h2>

            <!-- Candidate nomination status alert -->
            {% if not candidate or not candidate.is_approved %}
            <div class="alert alert-warning alert-dismissible fade show" role="alert">
                <i class="fas fa-info-circle"></i> 
                <strong>Your nomination is pending approval.</strong> 
                The election admin will review and approve your nomination soon. Check back for updates.
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            {% endif %}

            <!-- Main candidate information cards -->
            <div class="row mb-4">
                <!-- Candidate information card -->
                <div class="col-md-6 mb-3">
                    <div class="card shadow-sm border-left-primary">
                        <div class="card-body">
                            <h6 class="text-muted">
                                <i class="fas fa-user"></i> Candidate Information
                            </h6>
                            <div class="mt-3">
                                <!-- Candidate name -->
                                <p class="small text-muted mb-1">Full Name</p>
                                <p class="h6 mb-3">{{ logged_in_user.name }}</p>

                                <!-- Candidate email -->
                                <p class="small text-muted mb-1">Email</p>
                                <p class="h6 mb-3">{{ logged_in_user.email }}</p>

                                <!-- Political party -->
                                <p class="small text-muted mb-1">Political Party</p>
                                <p class="h6">
                                    {% if candidate %}
                                        <span class="badge badge-info">
                                            {{ candidate.party_name }}
                                        </span>
                                    {% else %}
                                        <span class="badge badge-secondary">Not specified</span>
                                    {% endif %}
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Nomination status card -->
                <div class="col-md-6 mb-3">
                    <div class="card shadow-sm border-left-info">
                        <div class="card-body">
                            <h6 class="text-muted">
                                <i class="fas fa-file-contract"></i> Nomination Status
                            </h6>
                            <div class="mt-3">
                                <!-- Nomination status -->
                                <p class="small text-muted mb-1">Current Status</p>
                                <p class="h6 mb-3">
                                    {% if candidate %}
                                        {% if candidate.nomination_status == 'approved' %}
                                            <span class="badge badge-success">
                                                <i class="fas fa-check-circle"></i> Approved
                                            </span>
                                        {% elif candidate.nomination_status == 'pending' %}
                                            <span class="badge badge-warning">
                                                <i class="fas fa-hourglass-half"></i> Pending Review
                                            </span>
                                        {% elif candidate.nomination_status == 'rejected' %}
                                            <span class="badge badge-danger">
                                                <i class="fas fa-times-circle"></i> Rejected
                                            </span>
                                        {% else %}
                                            <span class="badge badge-secondary">{{ candidate.nomination_status }}</span>
                                        {% endif %}
                                    {% else %}
                                        <span class="badge badge-secondary">Not submitted</span>
                                    {% endif %}
                                </p>

                                <!-- Approval status -->
                                <p class="small text-muted mb-1">Election Participation</p>
                                <p class="h6">
                                    {% if candidate and candidate.is_approved %}
                                        <span class="badge badge-success">
                                            <i class="fas fa-check"></i> Active in Election
                                        </span>
                                    {% else %}
                                        <span class="badge badge-secondary">
                                            <i class="fas fa-hourglass-half"></i> Not Yet Active
                                        </span>
                                    {% endif %}
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Voting statistics -->
            <div class="row mb-4">
                <!-- Total votes received -->
                <div class="col-md-4">
                    <div class="card shadow-sm border-left-success">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <p class="text-muted small m-0">Total Votes</p>
                                    <p class="h4 mb-0">
                                        {% if candidate %}
                                            {{ candidate.total_votes }}
                                        {% else %}
                                            0
                                        {% endif %}
                                    </p>
                                </div>
                                <div style="font-size: 36px; color: #1cc88a;">
                                    <i class="fas fa-vote"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Nomination date -->
                <div class="col-md-4">
                    <div class="card shadow-sm border-left-info">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <p class="text-muted small m-0">Registered On</p>
                                    <p class="h6 mb-0">
                                        {{ logged_in_user.created_at.strftime('%d %b %Y') }}
                                    </p>
                                </div>
                                <div style="font-size: 36px; color: #36b9cc;">
                                    <i class="fas fa-calendar"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Voter count -->
                <div class="col-md-4">
                    <div class="card shadow-sm border-left-primary">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <p class="text-muted small m-0">Eligible Voters</p>
                                    <p class="h4 mb-0">{{ total_voters }}</p>
                                </div>
                                <div style="font-size: 36px; color: #4e73df;">
                                    <i class="fas fa-users"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick actions -->
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-primary text-white">
                    <h6 class="mb-0">
                        <i class="fas fa-flash"></i> Quick Actions
                    </h6>
                </div>

                <div class="card-body">
                    <div class="row">
                        <!-- View Results button -->
                        <div class="col-md-6 mb-2">
                            <a href="{{ url_for('candidate.results') }}" class="btn btn-outline-primary w-100">
                                <i class="fas fa-chart-bar"></i> View Election Results
                            </a>
                        </div>

                        <!-- Manage Nomination button -->
                        <div class="col-md-6 mb-2">
                            <a href="{{ url_for('candidate.submit_nomination') }}" class="btn btn-outline-info w-100">
                                <i class="fas fa-file-contract"></i> Manage Nomination
                            </a>
                        </div>

                        {% if candidate and candidate.nomination_status == 'pending' %}
                        <!-- Cancel Nomination button -->
                        <div class="col-md-6 mb-2">
                            <button class="btn btn-outline-danger w-100" onclick="cancelNomination()">
                                <i class="fas fa-times"></i> Cancel Nomination
                            </button>
                        </div>
                        {% endif %}

                        <!-- Logout button -->
                        <div class="col-md-6 mb-2">
                            <a href="{{ url_for('auth.logout') }}" class="btn btn-outline-secondary w-100">
                                <i class="fas fa-sign-out-alt"></i> Logout
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Information box -->
            <div class="card shadow-sm">
                <div class="card-header bg-info text-white">
                    <h6 class="mb-0">
                        <i class="fas fa-info-circle"></i> Important Information
                    </h6>
                </div>

                <div class="card-body">
                    <!-- Key information for candidates -->
                    <ul class="list-unstyled">
                        <li class="mb-2">
                            <i class="fas fa-check text-success"></i> 
                            <strong>Nomination Process:</strong>
                            Submit your nomination form and await approval from the election administrator.
                        </li>
                        <li class="mb-2">
                            <i class="fas fa-check text-success"></i>
                            <strong>Vote Counting:</strong>
                            Votes are counted in real-time. Results are updated automatically as voters cast their votes.
                        </li>
                        <li class="mb-2">
                            <i class="fas fa-check text-success"></i>
                            <strong>Results Display:</strong>
                            Once voting concludes, final results will be displayed with vote percentages and rankings.
                        </li>
                        <li class="mb-2">
                            <i class="fas fa-check text-success"></i>
                            <strong>Contact Admin:</strong>
                            For any queries or issues, contact the election administrator using the contact page.
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Script for candidate actions -->
<script>
// Function to cancel a nomination
function cancelNomination() {
    // Confirm action with user
    if (confirm('Are you sure you want to cancel your nomination? This action cannot be undone.')) {
        // Send POST request to cancel endpoint
        fetch('{{ url_for("candidate.cancel_nomination") }}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        })
        .then(response => response.json())
        .then(data => {
            // Show success message
            if (data.success) {
                alert('Nomination cancelled successfully');
                // Reload page after 1 second
                setTimeout(() => location.reload(), 1000);
            } else {
                // Show error message
                alert('Error: ' + (data.message || 'Failed to cancel nomination'));
            }
        })
        .catch(error => {
            // Show error if network request fails
            alert('Error: ' + error.message);
        });
    }
}
</script>

<!-- CSS styling for the page -->
<style>
/* Border accent styling for cards */
.border-left-primary {
    border-left: 4px solid #4e73df !important;
}

.border-left-info {
    border-left: 4px solid #36b9cc !important;
}

.border-left-success {
    border-left: 4px solid #1cc88a !important;
}

/* Utility classes */
.w-100 {
    width: 100%;
}

.mb-2 {
    margin-bottom: 0.5rem;
}

.mb-3 {
    margin-bottom: 1rem;
}

.mb-4 {
    margin-bottom: 1.5rem;
}

/* List styling */
.list-unstyled li:before {
    content: '';
}
</style>
{% endblock %}
