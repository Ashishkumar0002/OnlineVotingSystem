<!-- Admin Change Password Page -->
<!-- This page allows the admin to change their account password for security -->
{% extends 'base.html' %}

<!-- Page content block - inherited from base.html -->
{% block content %}
<div class="container-fluid">
    <div class="row">
        <!-- Sidebar Navigation -->
        <div class="col-md-3">
            <div class="card shadow-sm mb-4" style="position: sticky; top: 20px;">
                <!-- Sidebar header with admin info -->
                <div class="card-body text-center">
                    <!-- Display admin icon -->
                    <div style="font-size: 48px; margin-bottom: 15px;">
                        <i class="fas fa-user-shield"></i>
                    </div>
                    <!-- Display admin name -->
                    <h5 class="card-title">{{ logged_in_user.name }}</h5>
                    <!-- Display admin role badge -->
                    <p class="text-muted">
                        <span class="badge badge-primary">Administrator</span>
                    </p>
                </div>

                <!-- Admin navigation menu -->
                <div class="list-group list-group-flush">
                    <!-- Link to dashboard -->
                    <a href="{{ url_for('admin.dashboard') }}" class="list-group-item list-group-item-action">
                        <i class="fas fa-chart-line"></i> Dashboard
                    </a>
                    <!-- Link to pending voters -->
                    <a href="{{ url_for('admin.pending_voters') }}" class="list-group-item list-group-item-action">
                        <i class="fas fa-hourglass-half"></i> Pending Voters
                    </a>
                    <!-- Link to pending candidates -->
                    <a href="{{ url_for('admin.pending_candidates') }}" class="list-group-item list-group-item-action">
                        <i class="fas fa-user-tie"></i> Pending Candidates
                    </a>
                    <!-- Link to voting logs -->
                    <a href="{{ url_for('admin.voting_logs') }}" class="list-group-item list-group-item-action">
                        <i class="fas fa-file-alt"></i> Voting Logs
                    </a>
                    <!-- Link to change password (current page) -->
                    <a href="{{ url_for('admin.change_password') }}" class="list-group-item list-group-item-action active">
                        <i class="fas fa-lock"></i> Change Password
                    </a>
                    <!-- Logout link -->
                    <a href="{{ url_for('auth.logout') }}" class="list-group-item list-group-item-action text-danger">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </a>
                </div>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="col-md-9">
            <!-- Page header with title -->
            <div class="mb-4">
                <h2>
                    <i class="fas fa-lock text-primary"></i> Change Admin Password
                </h2>
                <p class="text-muted">Update your admin account password regularly for security</p>
            </div>

            <!-- Password change form -->
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h6 class="mb-0">
                        <i class="fas fa-key"></i> Password Change Form
                    </h6>
                </div>

                <div class="card-body">
                    <!-- Form to submit password change request -->
                    <!-- Note: This form posts to the change_password route with admin role check -->
                    <form id="passwordChangeForm" method="POST" action="{{ url_for('admin.change_password') }}">
                        <!-- Current password field -->
                        <!-- Admin must enter current password for verification -->
                        <div class="form-group mb-3">
                            <label for="current_password" class="form-label">
                                <i class="fas fa-key"></i> Current Password
                            </label>
                            <!-- Password input field -->
                            <input 
                                type="password" 
                                class="form-control" 
                                id="current_password" 
                                name="current_password" 
                                placeholder="Enter your current password"
                                required>
                            <!-- Hint text explaining this is required -->
                            <small class="form-text text-muted">
                                We need your current password to verify your identity
                            </small>
                        </div>

                        <!-- New password field -->
                        <!-- Admin enters the new password they want to use -->
                        <div class="form-group mb-3">
                            <label for="new_password" class="form-label">
                                <i class="fas fa-lock"></i> New Password
                            </label>
                            <!-- Password input field with validation -->
                            <input 
                                type="password" 
                                class="form-control" 
                                id="new_password" 
                                name="new_password" 
                                placeholder="Enter new password"
                                required>
                            <!-- Password requirements display -->
                            <small class="form-text text-muted d-block mt-2">
                                <strong>Password must contain:</strong>
                                <ul class="mb-0 mt-1">
                                    <li>✓ At least 8 characters</li>
                                    <li>✓ At least 1 uppercase letter (A-Z)</li>
                                    <li>✓ At least 1 lowercase letter (a-z)</li>
                                    <li>✓ At least 1 digit (0-9)</li>
                                    <li>✓ At least 1 special character (!@#$%^&*)</li>
                                </ul>
                            </small>
                        </div>

                        <!-- Confirm new password field -->
                        <!-- Admin re-enters new password to confirm it's correct -->
                        <div class="form-group mb-4">
                            <label for="confirm_password" class="form-label">
                                <i class="fas fa-check-circle"></i> Confirm New Password
                            </label>
                            <!-- Password input field for confirmation -->
                            <input 
                                type="password" 
                                class="form-control" 
                                id="confirm_password" 
                                name="confirm_password" 
                                placeholder="Re-enter new password"
                                required>
                            <!-- Hint text explaining this is for verification -->
                            <small class="form-text text-muted">
                                Must match the new password above
                            </small>
                        </div>

                        <!-- Form action buttons -->
                        <div class="d-flex gap-2">
                            <!-- Submit button to change password -->
                            <button 
                                type="submit" 
                                class="btn btn-primary"
                                onclick="return validatePasswordForm()">
                                <i class="fas fa-save"></i> Change Password
                            </button>

                            <!-- Cancel button to go back -->
                            <a href="{{ url_for('admin.dashboard') }}" class="btn btn-secondary">
                                <i class="fas fa-times"></i> Cancel
                            </a>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Security information card -->
            <div class="card shadow-sm mt-4 border-left-info">
                <div class="card-header bg-info text-white">
                    <h6 class="mb-0">
                        <i class="fas fa-shield-alt"></i> Password Security Tips
                    </h6>
                </div>

                <div class="card-body">
                    <!-- Security recommendations -->
                    <div class="row">
                        <!-- Tip 1: Use Strong Passwords -->
                        <div class="col-md-6 mb-3">
                            <div class="d-flex">
                                <div class="mr-3" style="flex-shrink: 0;">
                                    <i class="fas fa-lock-open text-success" style="font-size: 24px;"></i>
                                </div>
                                <div>
                                    <h6>Use Strong Passwords</h6>
                                    <p class="small mb-0">
                                        Create passwords that are difficult to guess. Use a mix of uppercase, lowercase, 
                                        numbers, and special characters.
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Tip 2: Change Regularly -->
                        <div class="col-md-6 mb-3">
                            <div class="d-flex">
                                <div class="mr-3" style="flex-shrink: 0;">
                                    <i class="fas fa-calendar-alt text-info" style="font-size: 24px;"></i>
                                </div>
                                <div>
                                    <h6>Change Regularly</h6>
                                    <p class="small mb-0">
                                        Update your password every 90 days. This reduces the risk if your password 
                                        is compromised.
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Tip 3: Keep It Secret -->
                        <div class="col-md-6 mb-3">
                            <div class="d-flex">
                                <div class="mr-3" style="flex-shrink: 0;">
                                    <i class="fas fa-eye-slash text-warning" style="font-size: 24px;"></i>
                                </div>
                                <div>
                                    <h6>Keep It Secret</h6>
                                    <p class="small mb-0">
                                        Never share your password with anyone, including IT staff or system administrators. 
                                        They will never ask for it.
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Tip 4: Unique Password -->
                        <div class="col-md-6 mb-3">
                            <div class="d-flex">
                                <div class="mr-3" style="flex-shrink: 0;">
                                    <i class="fas fa-star text-danger" style="font-size: 24px;"></i>
                                </div>
                                <div>
                                    <h6>Use Unique Password</h6>
                                    <p class="small mb-0">
                                        Don't reuse passwords across different systems. If one account is compromised, 
                                        others remain secure.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent activity information -->
            <div class="card shadow-sm mt-4">
                <div class="card-header bg-secondary text-white">
                    <h6 class="mb-0">
                        <i class="fas fa-history"></i> Account Information
                    </h6>
                </div>

                <div class="card-body">
                    <!-- Display current admin account information -->
                    <div class="row">
                        <!-- Admin name -->
                        <div class="col-md-6 mb-3">
                            <p class="text-muted small">Admin Name</p>
                            <p class="h6">{{ logged_in_user.name }}</p>
                        </div>

                        <!-- Admin email -->
                        <div class="col-md-6 mb-3">
                            <p class="text-muted small">Email Address</p>
                            <p class="h6">{{ logged_in_user.email }}</p>
                        </div>

                        <!-- Account verified status -->
                        <div class="col-md-6 mb-3">
                            <p class="text-muted small">Account Status</p>
                            <p class="h6">
                                {% if logged_in_user.is_verified %}
                                    <span class="badge badge-success">
                                        <i class="fas fa-check-circle"></i> Verified
                                    </span>
                                {% else %}
                                    <span class="badge badge-warning">
                                        <i class="fas fa-hourglass-half"></i> Pending Verification
                                    </span>
                                {% endif %}
                            </p>
                        </div>

                        <!-- Account creation date -->
                        <div class="col-md-6 mb-3">
                            <p class="text-muted small">Account Created</p>
                            <p class="h6">{{ logged_in_user.created_at.strftime('%d %B %Y') }}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Script for form validation -->
<script>
// Function to validate the password change form
function validatePasswordForm() {
    // Get form input values
    const currentPassword = document.getElementById('current_password').value;
    const newPassword = document.getElementById('new_password').value;
    const confirmPassword = document.getElementById('confirm_password').value;
    
    // Validate current password is not empty
    if (!currentPassword) {
        showError('Please enter your current password');
        return false;
    }
    
    // Validate new password is not empty
    if (!newPassword) {
        showError('Please enter a new password');
        return false;
    }
    
    // Validate confirm password is not empty
    if (!confirmPassword) {
        showError('Please confirm your new password');
        return false;
    }
    
    // Validate passwords match
    if (newPassword !== confirmPassword) {
        showError('New passwords do not match');
        return false;
    }
    
    // Validate current and new password are different
    if (currentPassword === newPassword) {
        showError('New password must be different from current password');
        return false;
    }
    
    // Validate password strength (at least 8 chars, uppercase, lowercase, digit, special)
    const passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*])[a-zA-Z\d!@#$%^&*]{8,}$/;
    
    if (!passwordRegex.test(newPassword)) {
        showError('Password does not meet security requirements. Check the requirements above.');
        return false;
    }
    
    // If all validations pass, allow form submission
    showInfo('Changing password...');
    return true;
}

// Show error alert
function showError(message) {
    alert('Error: ' + message);
}

// Show info alert
function showInfo(message) {
    alert('Info: ' + message);
}
</script>

<!-- CSS styling for the page -->
<style>
/* Style for border-left accent on cards */
.border-left-info {
    border-left: 4px solid #36b9cc !important;
}

/* Gap utility class for buttons */
.gap-2 {
    gap: 0.5rem;
}

/* Margin right utility for flex layouts */
.mr-3 {
    margin-right: 1rem;
}

/* Password requirements list styling -->
.form-text ul li {
    list-style-type: none;
    padding-left: 1.5rem;
}
</style>
{% endblock %}
